
# SLAM 14讲 高翔


# 1 - 3 章 简单回顾

## 第一章 

SLAM的两个主要问题， 1. 明白自身的状态（位置）， 2. 了解外在的环境 （建图）。
可以通过两类方式来实现： 一是通过携带于机器人本体上的传感器；而是通过安装于环境当中的标志。

==单目相机==： 通过二维信息记录了世界，但是损失了深度信息。但是可以通过相机的移动来确定物体得视差，然后来判断物体的**远近**，但是因为这个远近只是一个相对值，所以缺少一个尺度因子，单目图像无法确定这个真实尺度，又称为**尺度不确定性**。
==双目相机==：在单目相机的基础上，通过双目生成的**视差图**来对深度进行计算，但是他计算出来的结果也不是很准确的，同时双目相机能探测到的深度范围和基线相关，基线越大能测量到的物体就越远，同时他的计算量也比较大， 需要使用GPU或者FPGA设备进行加速，目前**计算量**是双目的主要问题之一。
==深度相机==： 也叫RGB-D相机，通过物理测量的手段，相比于双目相机节省了大量的计算资源。但是还存在测量范围窄、噪声大、视野小、易受日光干扰等因素，目前**主要用于室内**，室外较难应用。

#### 经典视觉SLAM框架

1. 传感器信息获取： 视觉SLAM中主要表现为相机图像的信息的读取和预处理。
2. 前端视觉里程计（Visual Odometry VO）：用于估计相邻图像间相机的运动，以及局部地图的样子。 VO 也被称为前端。
3. 后端非线性优化（Optimization） ： 对不同时刻的视觉里程计测量的相机位姿和回环信息进行优化，得到全局一致的轨迹和地图。
4. 回环检测 （Loop Closure Detection）：回环检测判断机器人是否到达过先前的位置， 如果检测到回环，会把信息给后端进行处理。
5. 建图（Mapping）： 根据估计的轨迹， 建立与任务要求对应的地图。包括度量地图和拓扑地图，两种。

==在视觉SLAM中， 前端和计算机视觉研究领域更为相关，比如图像的特征提取与匹配等，后端则主要是滤波与非线性优化算法。==

### 三维钢体运动

####  描述三维运动 （欧式变换）
1. 旋转矩阵： 3 * 3 的单位正交阵，9个量表述了3个自由度。
2. 旋转向量：用一个旋转轴和旋转角来描述， 向量的方向和旋转轴方向一致，长度等于旋转角。从旋转向量转为旋转矩阵，可以通过罗德里格斯公式来计算：
 单位长度的向量为 $n$ , 旋转的角度为$\theta$.
 则 旋转矩阵$R$   = $cos\theta I + (1 - cos\theta)n n^T + sin\theta n^{反对称}$。
 从旋转矩阵到旋转向量也可以进行转换。
3. 欧拉角： 使用三个角度（yaw 偏航角 pitch 俯仰角 roll 滚转角）来描述。
4. 四元数： 因为旋转矩阵有冗余性，旋转向量和欧拉角有奇异性，通过四元数来描述，是复数域中的定义。使用前需要归一化。
#### 相似、仿射、射影变换
![[1-3 figure1.png]]

# 第4章 李群与李代数 （不会，略）

简单来说就是 ，李代数可以求导，而且是连续的，所以在优化的时候可以更好的通过数学方法来解决。


# 第5章 相机与图像

### 针孔相机模型

### 畸变模型



# 第6章 非线性优化



### 实操：曲线拟合

曲线方程： 
$y = exp(ax^2 + bx + c) + w$
其中$a, b, c$ 为曲线参数， $w$为高斯噪声 $w \thicksim (0, \sigma^2)$
我们有$N$个关于$x, y$的观测值，我们想根据这些数据点估计出曲线的参数，可以通过下面的最小二乘问题估计曲线的参数：

$min_{a, b,c} \frac{1}{2} \sum_{i = 1}^{N}\|y_i - exp(ax^2_i + bx_i + c)\|^2$

然后定义误差为 $f(e_i)$：

$e_i = y_i - exp(ax^2_i + bx_i + c)$

然后可以求出每个误差项对于状态变量的导数， 也就是$a, b, c$的偏导数。
$\frac{\partial e_i}{a} = - x_i^2exp(ax^2_i + bx_i + c)$
$\frac{\partial e_i}{b} =- x_iexp(ax^2_i + bx_i + c)$
$\frac{\partial e_i}{c} =-exp(ax^2_i + bx_i + c)$

#### 高斯牛顿法：

#### Ceres求解：

使用Ceres求解最小二乘问题的最优解的一般步骤如下：
1. 构建优化问题的Problem类
2. 构建优化的残差函数CostFunction
3. 最小二乘问题构建，在内次获取到数据后添加残差块
4. 求解最小二乘问题




